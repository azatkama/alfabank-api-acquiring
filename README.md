# PHP –∫–ª–∏–µ–Ω—Ç –¥–ª—è —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞

[![Latest Stable Version](https://poser.pugx.org/kostikpenzin/alfabank-api-acquiring/v/stable)](https://packagist.org/packages/kostikpenzin/alfabank-api-acquiring)
[![Total Downloads](https://poser.pugx.org/kostikpenzin/alfabank-api-acquiring/downloads)](https://packagist.org/packages/kostikpenzin/alfabank-api-acquiring)
[![Latest Unstable Version](https://poser.pugx.org/kostikpenzin/alfabank-api-acquiring/v/unstable)](https://packagist.org/packages/kostikpenzin/alfabank-api-acquiring)
[![License](https://poser.pugx.org/kostikpenzin/alfabank-api-acquiring/license)](https://packagist.org/packages/kostikpenzin/alfabank-api-acquiring)
[![Monthly Downloads](https://poser.pugx.org/kostikpenzin/alfabank-api-acquiring/d/monthly)](https://packagist.org/packages/kostikpenzin/alfabank-api-acquiring)
[![PHP Version Require](https://poser.pugx.org/kostikpenzin/alfabank-api-acquiring/require/php)](https://packagist.org/packages/kostikpenzin/alfabank-api-acquiring)

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è PHP –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å API –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –∏ —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç–µ–∂–µ–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –∏ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üöÄ **–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ API** - –≤—Å–µ –º–µ—Ç–æ–¥—ã –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞
- üîê **–ì–∏–±–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å
- üí≥ **–ü—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã** - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- üìã **PSR-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã PHP
- üîß **–ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –º–∏–Ω–∏–º—É–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞
- üìö **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 7.4 –∏–ª–∏ –≤—ã—à–µ
- Composer
- –†–∞—Å—à–∏—Ä–µ–Ω–∏—è: `curl`, `json`, `mbstring`
- –ê–∫–∫–∞—É–Ω—Ç –º–µ—Ä—á–∞–Ω—Ç–∞ –≤ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–µ

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
composer require kostikpenzin/alfabank-api-acquiring
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞

```php
<?php

require_once 'vendor/autoload.php';

use kostikpenzin\AlfabankApiAcquiring\Client;

// –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Ç–æ–∫–µ–Ω—É (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
$client = new Client([
    'baseUrl' => 'https://alfa.rbsuat.com', // —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞
    'token' => 'your-api-token'
]);

// –ò–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –ª–æ–≥–∏–Ω—É/–ø–∞—Ä–æ–ª—é
$client = new Client([
    'baseUrl' => 'https://alfa.rbsuat.com',
    'userName' => 'your-username',
    'password' => 'your-password'
]);
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```php
$orderId = 'order_' . time();

$response = $client->register([
    'orderNumber' => $orderId,
    'amount' => 10000, // —Å—É–º–º–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö (100.00 —Ä—É–±)
    'returnUrl' => 'https://your-site.com/payment/success',
    'failUrl' => 'https://your-site.com/payment/fail',
    'description' => '–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ #' . $orderId,
    'language' => 'ru',
    'clientId' => 'customer_123',
    'email' => 'customer@example.com',
]);

if (isset($response['formUrl'])) {
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã
    header('Location: ' . $response['formUrl']);
} else {
    // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É
    echo '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞: ' . ($response['errorMessage'] ?? 'Unknown error');
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

```php
$status = $client->getOrderStatus([
    'orderId' => $response['orderId'] // ID –∑–∞–∫–∞–∑–∞ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
]);

switch ($status['OrderStatus']) {
    case 0:
        echo '–ó–∞–∫–∞–∑ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–æ –Ω–µ –æ–ø–ª–∞—á–µ–Ω';
        break;
    case 1:
        echo '–ü—Ä–µ–¥–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ –∑–∞—Ö–æ–ª–¥–∏—Ä–æ–≤–∞–Ω–∞';
        break;
    case 2:
        echo '–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞';
        break;
    case 3:
        echo '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞';
        break;
    case 4:
        echo '–ü–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—ã–ª–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞';
        break;
    case 5:
        echo '–ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ ACS –±–∞–Ω–∫–∞-—ç–º–∏—Ç–µ–Ω—Ç–∞';
        break;
    case 6:
        echo '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞';
        break;
}
```

## –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```php
$client = new Client([
    'baseUrl' => 'https://web.rbsuat.com', // URL API (prod: https://web.rbsuat.com)
    'token' => 'your-token',               // API —Ç–æ–∫–µ–Ω
    'userName' => 'merchant_login',        // –õ–æ–≥–∏–Ω –º–µ—Ä—á–∞–Ω—Ç–∞
    'password' => 'merchant_password',     // –ü–∞—Ä–æ–ª—å –º–µ—Ä—á–∞–Ω—Ç–∞
    'timeout' => 30,                       // –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    'connect_timeout' => 10,               // –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
]);
```

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```php
$client = new Client([
    'baseUrl' => $_ENV['ALFABANK_BASE_URL'] ?? 'https://alfa.rbsuat.com',
    'token' => $_ENV['ALFABANK_TOKEN'],
]);
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–∞

```php
// –ë–∞–∑–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
$response = $client->register([
    'orderNumber' => 'ORDER_001',
    'amount' => 150000, // 1500.00 —Ä—É–± –≤ –∫–æ–ø–µ–π–∫–∞—Ö
    'returnUrl' => 'https://shop.com/success',
    'failUrl' => 'https://shop.com/fail',
    'description' => '–ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–∞',
]);

// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
$response = $client->register([
    'orderNumber' => 'ORDER_001',
    'amount' => 150000,
    'currency' => 643, // RUB
    'returnUrl' => 'https://shop.com/success',
    'failUrl' => 'https://shop.com/fail',
    'description' => '–ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–∞',
    'language' => 'ru',
    'pageView' => 'DESKTOP',
    'clientId' => 'client_123',
    'merchantLogin' => 'sub_merchant',
    'jsonParams' => [
        'email' => 'client@example.com',
        'phone' => '+7-900-123-45-67'
    ],
    'sessionTimeoutSecs' => 1200,
    'expirationDate' => '2024-12-31T23:59:59',
    'features' => 'AUTO_PAYMENT'
]);
```

#### 2. –ü—Ä–µ–¥–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```php
$response = $client->registerPreAuth([
    'orderNumber' => 'PREAUTH_001',
    'amount' => 50000,
    'returnUrl' => 'https://shop.com/success',
    'description' => '–ü—Ä–µ–¥–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞'
]);

// –ü–æ–∑–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞—Ç–µ–∂
if ($response['orderId']) {
    $depositResponse = $client->deposit([
        'orderId' => $response['orderId'],
        'amount' => 30000 // –º–æ–∂–Ω–æ —Å–ø–∏—Å–∞—Ç—å –º–µ–Ω—å—à–µ
    ]);
}
```

#### 3. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ

```php
$detailedStatus = $client->getOrderStatusExtended([
    'orderId' => 'order-uuid',
    'orderNumber' => 'ORDER_001'
]);

// –ü–æ–ª—É—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
echo "–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: " . $detailedStatus['Pan'];
echo "–ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: " . $detailedStatus['approvalCode'];
echo "–°—É–º–º–∞ –∫ —Å–ø–∏—Å–∞–Ω–∏—é: " . $detailedStatus['depositAmount'];
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞–º–∏

#### –û—Ç–º–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```php
$response = $client->reverse([
    'orderId' => 'order-uuid'
]);

if ($response['errorCode'] === '0') {
    echo '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω–∞';
}
```

#### –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤

```php
// –ü–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
$response = $client->refund([
    'orderId' => 'order-uuid',
    'amount' => 150000 // –ø–æ–ª–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
]);

// –ß–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
$response = $client->refund([
    'orderId' => 'order-uuid',
    'amount' => 50000 // —á–∞—Å—Ç–∏—á–Ω–∞—è —Å—É–º–º–∞
]);
```

### –†–∞–±–æ—Ç–∞ —Å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç

```php
$bindings = $client->getBindings([
    'clientId' => 'client_123'
]);

foreach ($bindings as $binding) {
    echo "–ö–∞—Ä—Ç–∞: " . $binding['pan'];
    echo "ID –ø—Ä–∏–≤—è–∑–∫–∏: " . $binding['bindingId'];
    echo "–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: " . $binding['expiryDate'];
}
```

#### –û–ø–ª–∞—Ç–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ–π

```php
// –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π
$order = $client->register([
    'orderNumber' => 'BINDING_ORDER_001',
    'amount' => 75000,
    'returnUrl' => 'https://shop.com/success',
    'bindingId' => 'binding-uuid-here',
    'description' => '–û–ø–ª–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ–π'
]);

// –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Å—Ç–∏ –æ–ø–ª–∞—Ç—É
$payment = $client->paymentOrderBinding([
    'mdOrder' => $order['orderId'],
    'bindingId' => 'binding-uuid-here',
    'ip' => $_SERVER['REMOTE_ADDR'],
    'cvc' => '123', // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    'email' => 'client@example.com'
]);
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—è–∑–∫–∞–º–∏

```php
// –û—Ç–≤—è–∑–∞—Ç—å –∫–∞—Ä—Ç—É
$client->unBindCard([
    'bindingId' => 'binding-uuid'
]);

// –ü—Ä–æ–¥–ª–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É
$client->extendBinding([
    'bindingId' => 'binding-uuid',
    'newExpiry' => 202512 // YYYYMM
]);

// –ù–∞–π—Ç–∏ –ø—Ä–∏–≤—è–∑–∫–∏ –ø–æ –Ω–æ–º–µ—Ä—É –∫–∞—Ä—Ç—ã
$bindings = $client->getBindingsByCardOrId([
    'pan' => 411111111111,
    'showExpired' => false
]);
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫ –∑–∞–∫–∞–∑—É

```php
$response = $client->addParams([
    'orderId' => 'order-uuid',
    'params' => [
        'custom_field_1' => 'value1',
        'custom_field_2' => 'value2'
    ]
]);
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤

```php
$orders = $client->getLastOrdersForMerchants([
    'size' => 20,
    'from' => '2024-01-01T00:00:00',
    'to' => '2024-01-31T23:59:59',
    'transactionStates' => 'DEPOSITED,APPROVED',
    'merchants' => 'merchant_login'
]);
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—á–∞—Å—Ç–∏—è –≤ 3DS

```php
$enrollment = $client->verifyEnrollment([
    'pan' => 4111111111111111
]);

if ($enrollment['enrolled'] === 'Y') {
    echo '–ö–∞—Ä—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 3D-Secure';
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```php
try {
    $response = $client->register([
        'orderNumber' => 'ORDER_001',
        'amount' => 100000,
        'returnUrl' => 'https://shop.com/success'
    ]);
    
    if (isset($response['errorCode']) && $response['errorCode'] !== '0') {
        throw new Exception('API Error: ' . $response['errorMessage']);
    }
    
    // –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    $orderId = $response['orderId'];
    $paymentUrl = $response['formUrl'];
    
} catch (Exception $e) {
    error_log('Alfabank API Error: ' . $e->getMessage());
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
}
```

### –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| 0 | –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—à–ª–∞ –±–µ–∑ –æ—à–∏–±–æ–∫ |
| 1 | –ó–∞–∫–∞–∑ —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω |
| 3 | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≤–∞–ª—é—Ç–∞ |
| 4 | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä |
| 5 | –û—à–∏–±–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ |
| 6 | –ù–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π OrderId |
| 7 | –°–∏—Å—Ç–µ–º–Ω–∞—è –æ—à–∏–±–∫–∞ |

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç:

| –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|-------------|-----------|
| 4111 1111 1111 1111 | –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ |
| 4111 1111 1111 1112 | –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫—É —Å—Ä–µ–¥—Å—Ç–≤ |
| 4111 1111 1111 1113 | –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–æ –¥—Ä—É–≥–∏–º –ø—Ä–∏—á–∏–Ω–∞–º |

**–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- CVV: –ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞
- –ò–º—è –¥–µ—Ä–∂–∞—Ç–µ–ª—è: –ª—é–±–æ–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

```php
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
$testClient = new Client([
    'baseUrl' => 'https://alfa.rbsuat.com', // —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
    'token' => 'test-token-from-alfabank',
    'timeout' => 60 // —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
]);
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏

### Symfony

```php
// config/services.yaml
services:
    app.alfabank.client:
        class: kostikpenzin\AlfabankApiAcquiring\Client
        arguments:
            - baseUrl: '%env(ALFABANK_BASE_URL)%'
              token: '%env(ALFABANK_TOKEN)%'

// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
class PaymentController extends AbstractController
{
    public function __construct(
        private Client $alfabankClient
    ) {}
    
    public function createPayment(Request $request): Response
    {
        $response = $this->alfabankClient->register([
            'orderNumber' => $request->get('order_id'),
            'amount' => $request->get('amount'),
            'returnUrl' => $this->generateUrl('payment_success', [], UrlGeneratorInterface::ABSOLUTE_URL),
            'failUrl' => $this->generateUrl('payment_fail', [], UrlGeneratorInterface::ABSOLUTE_URL),
        ]);
        
        return $this->redirect($response['formUrl']);
    }
}
```

### Laravel

```php
// config/alfabank.php
return [
    'base_url' => env('ALFABANK_BASE_URL', 'https://alfa.rbsuat.com'),
    'token' => env('ALFABANK_TOKEN'),
];

// –í —Å–µ—Ä–≤–∏—Å-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ
$this->app->singleton(Client::class, function () {
    return new Client(config('alfabank'));
});

// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
class PaymentController extends Controller
{
    public function create(Request $request, Client $alfabank)
    {
        $response = $alfabank->register([
            'orderNumber' => $request->order_id,
            'amount' => $request->amount,
            'returnUrl' => route('payment.success'),
            'failUrl' => route('payment.fail'),
        ]);
        
        return redirect($response['formUrl']);
    }
}
```

## Webhooks –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –û–±—Ä–∞–±–æ—Ç–∫–∞ callback-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```php
// callback.php
$orderId = $_POST['orderId'] ?? null;

if ($orderId) {
    $status = $client->getOrderStatus(['orderId' => $orderId]);
    
    switch ($status['OrderStatus']) {
        case 2: // –û–ø–ª–∞—á–µ–Ω–æ
            // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –≤ –ë–î
            updateOrderStatus($orderId, 'paid');
            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É
            sendPaymentConfirmation($status['clientId']);
            break;
            
        case 6: // –û—Ç–∫–ª–æ–Ω–µ–Ω–æ
            updateOrderStatus($orderId, 'failed');
            break;
    }
}

// –û—Ç–≤–µ—Ç –±–∞–Ω–∫—É
http_response_code(200);
echo 'OK';
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ –∫–æ–¥–µ** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ callback-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** - –¥–ª—è –≤—Å–µ—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å API
4. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏
5. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ IP-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```php
// .env
ALFABANK_BASE_URL="https://web.rbsuat.com"
ALFABANK_TOKEN="your-production-token"
ALFABANK_CALLBACK_SECRET="your-callback-secret"

// –í–∞–ª–∏–¥–∞—Ü–∏—è callback
function validateCallback($data, $signature) {
    $expectedSignature = hash_hmac('sha256', 
        json_encode($data), 
        $_ENV['ALFABANK_CALLBACK_SECRET']
    );
    
    return hash_equals($expectedSignature, $signature);
}
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```php
use Monolog\Logger;
use Monolog\Handler\StreamHandler;

$logger = new Logger('alfabank');
$logger->pushHandler(new StreamHandler('logs/alfabank.log', Logger::INFO));

// –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
$logger->info('Creating payment order', [
    'order_id' => $orderId,
    'amount' => $amount,
    'client_id' => $clientId
]);

try {
    $response = $client->register($params);
    $logger->info('Payment order created successfully', [
        'alfabank_order_id' => $response['orderId']
    ]);
} catch (Exception $e) {
    $logger->error('Failed to create payment order', [
        'error' => $e->getMessage(),
        'params' => $params
    ]);
}
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞**: [alfabank.ru/sme/payservice/internet-acquiring/docs/](https://alfabank.ru/sme/payservice/internet-acquiring/docs/)
- **GitHub Issues**: [–°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ](https://github.com/kostikpenzin/alfabank-api-acquiring/issues)
- **Email**: penzin85@gmail.com

## –õ–∏—Ü–µ–Ω–∑–∏—è

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE).

## Changelog

### v1.2.0
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ API
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏

### v1.1.0
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏
- –£–ª—É—á—à–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–µ–ª–∫–∏–µ –±–∞–≥–∏

### v1.0.0
- –ü–µ—Ä–≤—ã–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑
- –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞

---

**–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è PHP-—Å–æ–æ–±—â–µ—Å—Ç–≤–∞**



API connection with the payment page on the bank's side.

## Installation

```bash
$ composer require kostikpenzin/alfabank-api-acquiring
```

### Example

```php
<?php

include 'vendor/autoload.php';

$client = new \kostikpenzin\AlfabankApiAcquiring\Client([
    'baseUrl' => 'https://alfa.rbsuat.com',
    'token' => "token", // or token
    'userName' => "name", // or userName and password
    'password' => "password"
]);

$orderId = "test" . rand();

// create order for pay
// https://alfabank.ru/sme/payservice/internet-acquiring/docs/connection-options/api/rest/#zapros_registratsii_zakaza
$response = $client->register([
            'orderNumber' => $orderId,
            'amount' => 10000,
            'returnUrl' => "https://returnUrl",
            'failUrl' => "https://failUrl",
            'description' => "description order",
            'language' => "ru",
            'clientId' => rand(),
            'email' => "penzin85@gmail.com",
]);

print_r($response);
/* response:
{
    "orderId":"70906e55-7114-41d6-8332-4609dc6590f4",
    "formUrl":"https://alfa.rbsuat.com/payment/merchants/test/payment_ru.html?mdOrder=70906e55-7114-41d6-8332-4609dc6590f4"
}
*/



// check status order
// https://alfabank.ru/sme/payservice/internet-acquiring/docs/connection-options/api/rest/#zapros_sostojanija_zakaza
$response = $client->getOrderStatus([
    'orderId' => $orderId
]);
print_r($response);
/* response:
{
    "expiration":"201512",
    "cardholderName":"tr tr",
    "depositAmount": 789789,
    "currency":"810",
    "approvalCode":"123456",
    "authCode": 2,
    "clientId":"666",
    "bindingId":"07a90a5d-cc60-4d1b-a9e6-ffd15974a74f",
    "ErrorCode":"0",
    "ErrorMessage":"–£—Å–ø–µ—à–Ω–æ",
    "OrderStatus": 2,
    "OrderNumber":"23asdafaf",
    Pan":"411111**1111",
    "Amount": 789789
}
*/


```

### Test cards for check integration

https://pay.alfabank.ru/ecommerce/faq/index.html
